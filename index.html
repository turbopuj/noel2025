<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ Memory de NoÃ«l Collaboratif ğŸ</title>

<style>
  body {
    font-family: "Arial", sans-serif;
    background: radial-gradient(circle at center, #f7f3ff 0%, #e5e0ff 100%);
    text-align: center;
    color: #21405f;
    margin: 0;
    padding: 20px;
  }

  h1 {
    font-size: 1.8em;
    margin-bottom: 1em;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
    max-width: 600px;
    margin: 0 auto;
  }

  .card {
    position: relative;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    border-radius: 12px;
    border: 3px solid rgba(33,128,141,0.3);
    background: linear-gradient(145deg, #dcd6f7, #b8b2ff);
    -webkit-mask-image: -webkit-radial-gradient(white, black);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transform: translateZ(0);
  }

  .card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    transform: scale(1);
    transition: transform 0.3s;
  }

  .card:hover img {
    transform: scale(1.05);
  }

  .card.hidden img {
    content: url("images/card-back.jpg");
  }

  .revelee {
    outline: 4px solid #64a35b;
  }
</style>
</head>
<body>

<h1>ğŸ„ Memory de NoÃ«l Collaboratif ğŸ</h1>
<p>ğŸ‘¥ Joueurs : LÃ©on | Capucine | Firmin</p>
<p id="status">â³ En attente des joueurs...</p>

<div class="grid" id="gameBoard"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

<script>
// ---- CONFIGURATION FIREBASE ----
const firebaseConfig = {
  apiKey: "AIzaSyAfiNtWKwVGmKPs0tgicoXwj5nVkhZn9zc",
  authDomain: "noel2025-robert.firebaseapp.com",
  databaseURL: "https://noel2025-robert-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "noel2025-robert",
  storageBucket: "noel2025-robert.firebasestorage.app",
  messagingSenderId: "172876284151",
  appId: "1:172876284151:web:b46253f95386aa4a7ad3f2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const playerParam = new URLSearchParams(window.location.search).get("player") || "inconnu";
const gameRef = db.ref("game_session");
const selectionsRef = gameRef.child("current_selections");
const revealedRef = gameRef.child("revealed_images");

// ---- VARIABLES GLOBALES ----
const board = document.getElementById("gameBoard");
const images = Array.from({length:10}, (_,i)=>"images/images"+(i+1));
let order = shuffle(images);
let revealed = [];
let ready = false;

// ---- FONCTIONS ----
function shuffle(array) {
  let arr = [...array];
  for(let i=arr.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// CrÃ©e une carte HTML
function createCard(src, index){
  const div = document.createElement("div");
  div.classList.add("card","hidden");
  const img = document.createElement("img");
  img.src = "images/card-back.jpg";
  img.alt = "Carte "+(index+1);
  div.appendChild(img);
  div.addEventListener("click", ()=>selectCard(src, div));
  return div;
}

// Ajout des cartes
order.forEach((img,i)=>board.appendChild(createCard(img,i)));

// Clique sur carte
function selectCard(imageSrc, div){
  selectionsRef.child(playerParam).set(imageSrc);
  div.classList.add("revelee");
}

// Mise Ã  jour Firebase -> rÃ©vÃ©lation collective
selectionsRef.on("value", snap=>{
  const data = snap.val() || {};
  const values = Object.values(data);
  if(values.length===3){
    if(values.every(v => v===values[0])){
      revealCard(values[0]);
      selectionsRef.set({});
    } else {
      resetSelections();
    }
  }
});

// RÃ©vÃ¨le carte visuellement
function revealCard(imgUrl){
  revealed.push(imgUrl);
  revealedRef.set(revealed);
  const cards = document.querySelectorAll(".card");
  cards.forEach(c=>{
    if(order.includes(imgUrl) && c.querySelector("img").src.includes("card-back")){
      const i = order.indexOf(imgUrl);
      if(order[i]===imgUrl){
        const el = c.querySelector("img");
        el.src = imgUrl;
        c.classList.remove("hidden");
      }
    }
  });
}

// RÃ©initialise les sÃ©lections si erreurs
function resetSelections(){
  const cards = document.querySelectorAll(".card");
  cards.forEach(c=>c.classList.remove("revelee"));
  setTimeout(()=>selectionsRef.set({}), 1000);
}

revealedRef.on("value", snap=>{
  const images = snap.val() || [];
  images.forEach(img=>revealCard(img));
});
</script>

</body>
</html>
